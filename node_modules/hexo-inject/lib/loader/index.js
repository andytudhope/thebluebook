'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = undefined;

var _bluebird = require('bluebird');

var _bluebird2 = _interopRequireDefault(_bluebird);

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var Loader = function () {
  function Loader(hexo) {
    _classCallCheck(this, Loader);

    this.hexo = hexo;
    this._loaders = {};
  }

  _createClass(Loader, [{
    key: 'register',
    value: function register(ext, loader) {
      if (!this._loaders[ext]) this._loaders[ext] = [];
      this._loaders[ext].push(loader);
    }
  }, {
    key: 'load',
    value: function () {
      var ref = (0, _bluebird.coroutine)(regeneratorRuntime.mark(function _callee(module, opts) {
        var render, content;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                render = this.hexo.render;
                content = opts.inline ? module.content : '';
                _context.next = 4;
                return _bluebird2.default.reduce(this._loaders[module.ext] || [], function (content, loader) {
                  return loader(content, opts);
                }, content);

              case 4:
                content = _context.sent;
                return _context.abrupt('return', content);

              case 6:
              case 'end':
                return _context.stop();
            }
          }
        }, _callee, this);
      }));

      function load(_x, _x2) {
        return ref.apply(this, arguments);
      }

      return load;
    }()
  }]);

  return Loader;
}();

exports.default = Loader;
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvYWRlci9pbmRleC5lczYiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7SUFDcUI7QUFDbkIsV0FEbUIsTUFDbkIsQ0FBYSxJQUFiLEVBQW1COzBCQURBLFFBQ0E7O0FBQ2pCLFNBQUssSUFBTCxHQUFZLElBQVosQ0FEaUI7QUFFakIsU0FBSyxRQUFMLEdBQWdCLEVBQWhCLENBRmlCO0dBQW5COztlQURtQjs7NkJBS1QsS0FBSyxRQUFRO0FBQ3JCLFVBQUksQ0FBQyxLQUFLLFFBQUwsQ0FBYyxHQUFkLENBQUQsRUFBcUIsS0FBSyxRQUFMLENBQWMsR0FBZCxJQUFxQixFQUFyQixDQUF6QjtBQUNBLFdBQUssUUFBTCxDQUFjLEdBQWQsRUFBbUIsSUFBbkIsQ0FBd0IsTUFBeEIsRUFGcUI7Ozs7O2tGQUlYLFFBQVE7WUFDWixRQUNGOzs7OztBQURFLHlCQUFXLEtBQUssSUFBTCxDQUFYO0FBQ0YsMEJBQVUsS0FBSyxNQUFMLEdBQWMsT0FBTyxPQUFQLEdBQWlCLEVBQS9COzt1QkFDRSxtQkFBUSxNQUFSLENBQWUsS0FBSyxRQUFMLENBQWMsT0FBTyxHQUFQLENBQWQsSUFBNkIsRUFBN0IsRUFBaUMsVUFBQyxPQUFELEVBQVUsTUFBVjt5QkFBcUIsT0FBTyxPQUFQLEVBQWdCLElBQWhCO2lCQUFyQixFQUE0QyxPQUE1Rjs7O0FBQWhCO2lEQUNPOzs7Ozs7Ozs7Ozs7Ozs7Ozs7U0FiVSIsImZpbGUiOiJsb2FkZXIvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUHJvbWlzZSBmcm9tICdibHVlYmlyZCdcclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTG9hZGVyIHtcclxuICBjb25zdHJ1Y3RvciAoaGV4bykge1xyXG4gICAgdGhpcy5oZXhvID0gaGV4b1xyXG4gICAgdGhpcy5fbG9hZGVycyA9IHt9XHJcbiAgfVxyXG4gIHJlZ2lzdGVyIChleHQsIGxvYWRlcikge1xyXG4gICAgaWYgKCF0aGlzLl9sb2FkZXJzW2V4dF0pIHRoaXMuX2xvYWRlcnNbZXh0XSA9IFtdXHJcbiAgICB0aGlzLl9sb2FkZXJzW2V4dF0ucHVzaChsb2FkZXIpXHJcbiAgfVxyXG4gIGFzeW5jIGxvYWQgKG1vZHVsZSwgb3B0cykge1xyXG4gICAgbGV0IHsgcmVuZGVyIH0gPSB0aGlzLmhleG9cclxuICAgIGxldCBjb250ZW50ID0gb3B0cy5pbmxpbmUgPyBtb2R1bGUuY29udGVudCA6ICcnXHJcbiAgICBjb250ZW50ID0gYXdhaXQgUHJvbWlzZS5yZWR1Y2UodGhpcy5fbG9hZGVyc1ttb2R1bGUuZXh0XSB8fCBbXSwgKGNvbnRlbnQsIGxvYWRlcikgPT4gbG9hZGVyKGNvbnRlbnQsIG9wdHMpLCBjb250ZW50KVxyXG4gICAgcmV0dXJuIGNvbnRlbnRcclxuICB9XHJcbn1cclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
